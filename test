plugins {
    id 'java'
}

group = 'com.example'
version = '1.0-SNAPSHOT'

repositories {
    mavenCentral()
}

dependencies {
    implementation 'org.apache.avro:avro:1.11.0'
    implementation 'com.fasterxml.jackson.core:jackson-databind:2.13.4'
}

java {
    toolchain {
        languageVersion.set(JavaLanguageVersion.of(17))
    }
}























import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.apache.avro.Schema;
import org.apache.avro.file.DataFileWriter;
import org.apache.avro.generic.GenericData;
import org.apache.avro.generic.GenericDatumWriter;
import org.apache.avro.generic.GenericRecord;

import java.io.File;
import java.io.IOException;
import java.util.Iterator;

public class ConvertJsonToAvro {

    public static void main(String[] args) {
        File schemaFile = new File("schema.avsc");
        File jsonFile = new File("data.json");
        File avroFile = new File("data.avro");

        try {
            // Parse the schema
            Schema schema = new Schema.Parser().parse(schemaFile);

            // Read JSON data
            ObjectMapper mapper = new ObjectMapper();
            JsonNode jsonData = mapper.readTree(jsonFile);

            // Prepare Avro writer
            GenericDatumWriter<GenericRecord> datumWriter = new GenericDatumWriter<>(schema);
            DataFileWriter<GenericRecord> dataFileWriter = new DataFileWriter<>(datumWriter);
            dataFileWriter.create(schema, avroFile);

            // Convert JSON to Avro
            Iterator<JsonNode> iterator = jsonData.elements();
            while (iterator.hasNext()) {
                JsonNode node = iterator.next();
                GenericRecord record = new GenericData.Record(schema);

                schema.getFields().forEach(field -> {
                    String fieldName = field.name();
                    record.put(fieldName, node.get(fieldName).asText()); // Handle different data types accordingly
                });

                dataFileWriter.append(record);
            }

            dataFileWriter.close();
            System.out.println("Conversion to Avro completed successfully.");

        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}