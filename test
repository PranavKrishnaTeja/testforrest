import org.apache.avro.file.DataFileReader;
import org.apache.avro.file.DataFileStream;
import org.apache.avro.generic.GenericDatumReader;
import org.apache.avro.generic.GenericRecord;
import org.apache.avro.io.DatumReader;

import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.IOException;

public class AvroFileToByteArrayConverter {

    public static byte[] convertAvroFileToByteArray(String filePath) throws IOException {
        File avroFile = new File(filePath);
        DatumReader<GenericRecord> datumReader = new GenericDatumReader<>();
        try (DataFileReader<GenericRecord> dataFileReader = new DataFileReader<>(avroFile, datumReader);
             ByteArrayOutputStream outputStream = new ByteArrayOutputStream()) {

            DataFileStream<GenericRecord> dataFileStream = new DataFileStream<>(dataFileReader, datumReader);

            // Iterate over the file and write each record to the output stream
            while (dataFileStream.hasNext()) {
                GenericRecord record = dataFileStream.next();
                dataFileStream.appendTo(outputStream); // Append each record to the output stream
            }

            return outputStream.toByteArray();
        }
    }
}









import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.mockito.Mockito;
import org.springframework.batch.item.ExecutionContext;

import java.io.IOException;

import static org.junit.jupiter.api.Assertions.assertNotNull;
import static org.mockito.ArgumentMatchers.anyLong;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.when;

class SposItemReaderTest {

    private SposItemReader sposItemReader;
    private SposStreamingClient sposStreamingClient;
    private final String documentId = "test_document";
    private LogRecordCreator logRecordCreator;

    @BeforeEach
    void setUp() throws Exception {
        sposStreamingClient = mock(SposStreamingClient.class);
        logRecordCreator = mock(LogRecordCreator.class);  // Mocking LogRecordCreator
        sposItemReader = new SposItemReader(sposStreamingClient, documentId);
    }

    @Test
    void testOpen() throws Exception {
        // Arrange
        byte[] avroBytes = AvroFileToByteArrayConverter.convertAvroFileToByteArray("path/to/your/avrofile.avro");
        when(sposStreamingClient.getObjectWithByteRange(anyString(), anyLong(), anyLong()))
                .thenReturn(avroBytes);

        // Act
        sposItemReader.open(new ExecutionContext());

        // Assert
        assertNotNull(sposItemReader);
        verify(sposStreamingClient, Mockito.times(1)).getObjectWithByteRange(anyString(), anyLong(), anyLong());
    }

    // Other tests...

}